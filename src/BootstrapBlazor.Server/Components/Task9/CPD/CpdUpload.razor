@page "/cpd-upload"
@layout PageLayout
@using BootstrapBlazor.Components
@namespace BootstrapBlazor.Server.Components.Task9.CPD

<h3>üìä CPD - Content Performance Dashboard</h3>

<DemoBlock Title="T·∫£i l√™n file CPD Excel" Name="CpdUpload">
    <div class="row">
        <div class="col-12 col-md-6">
            <BootstrapInput @bind-Value="DateKey" 
                           ShowLabel="true" 
                           DisplayText="Ng√†y d·ªØ li·ªáu" 
                           Type="InputType.Date" 
                           IsDisabled="@IsUploading" />
        </div>
        <div class="col-12 col-md-6">
            <BootstrapInput @bind-Value="FileName" 
                           ShowLabel="true" 
                           DisplayText="T√™n file" 
                           Placeholder="T√™n file Excel (t√πy ch·ªçn)"
                           IsDisabled="@IsUploading" />
        </div>
    </div>
    
    <div class="mt-3">
        <DropUpload OnChange="@OnDropCpdUpload" 
                    FooterText="Upload file CPD Excel (.xlsx)"
                    IsDisabled="@IsUploading"
                    IsMultiple="false"
                    ShowProgress="true"
                    ShowUploadFileList="true"
                    ShowFooter="true"
                    Accept=".xlsx">
        </DropUpload>
    </div>
    
    @if (IsUploading)
    {
        <div class="mt-3">
            <Spinner Size="Size.Large" />
            <span class="ms-2">ƒêang x·ª≠ l√Ω file...</span>
        </div>
    }
</DemoBlock>

@if (LastImportResult != null)
{
    <DemoBlock Title="K·∫øt qu·∫£ Import" Name="ImportResult">
        <div class="alert alert-success">
            <h5>‚úÖ Import th√†nh c√¥ng!</h5>
            <p><strong>Ng√†y:</strong> @LastImportResult.DateKey.ToString("dd/MM/yyyy")</p>
            <p><strong>T·ªïng s·ªë d√≤ng:</strong> @LastImportResult.TotalRows</p>
            <p><strong>D√≤ng m·ªõi:</strong> @LastImportResult.Inserted</p>
            <p><strong>D√≤ng c·∫≠p nh·∫≠t:</strong> @LastImportResult.Updated</p>
        </div>
        
        @if (LastImportResult.Diff != null)
        {
            <div class="mt-3">
                <h6>üìà Thay ƒë·ªïi so v·ªõi ng√†y tr∆∞·ªõc (@LastImportResult.Diff.PreviousDate.ToString("dd/MM/yyyy")):</h6>
                <div class="row">
                    <div class="col-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-success">@LastImportResult.Diff.NewCount</h5>
                                <p class="card-text">M·ªõi</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-warning">@LastImportResult.Diff.ChangedCount</h5>
                                <p class="card-text">Thay ƒë·ªïi</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-danger">@LastImportResult.Diff.RemovedCount</h5>
                                <p class="card-text">B·ªã x√≥a</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </DemoBlock>
}

@if (ImportErrors?.Any() == true)
{
    <DemoBlock Title="L·ªói Import" Name="ImportErrors">
        <div class="alert alert-danger">
            <h5>‚ùå C√≥ l·ªói x·∫£y ra:</h5>
            <ul>
                @foreach (var error in ImportErrors)
                {
                    <li>@error</li>
                }
            </ul>
        </div>
    </DemoBlock>
}
