@using BootstrapBlazor.Components
@using BootstrapBlazor.Server.Data
@using BootstrapBlazor.Server.Services
@namespace BootstrapBlazor.Server.Components.Task9.KeywordManager

<div class="monthly-metrics-manager">
    <h5 class="mb-3">
        <i class="fa-solid fa-chart-line me-2"></i>Search Volume theo tháng
    </h5>
    
    @if (IsLoading)
    {
        <div class="text-center p-3">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Đang tải...</span>
            </div>
        </div>
    }
    else
    {
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <BootstrapInput @bind-Value="@NewMetric.YearMonth" 
                    DisplayText="Tháng (YYYY-MM)" 
                    ShowLabel="true"
                    placeholder="2025-01"
                    IsDisabled="@IsAddingMetric" />
            </div>
            <div class="col-md-4">
                <BootstrapInput @bind-Value="@NewMetric.SearchVol" 
                    DisplayText="Search Volume" 
                    ShowLabel="true"
                    placeholder="100000"
                    IsDisabled="@IsAddingMetric" />
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <Button Color="Color.Primary" 
                    Icon="fa-solid fa-plus"
                    Text="Thêm"
                    OnClick="@OnAddMetric"
                    IsDisabled="@IsAddingMetric" />
            </div>
        </div>

        @if (MonthlyMetrics != null && MonthlyMetrics.Any())
        {
            <Table TItem="KeywordMonthlyMetricDto" 
                Items="@MonthlyMetrics"
                AutoGenerateColumns="false"
                IsPagination="false" 
                IsStriped="true" 
                IsBordered="true" 
                ShowToolbar="false">
                <TableColumns>
                    <TableColumn TItem="KeywordMonthlyMetricDto" TType="string" @bind-Field="@context.YearMonth" Text="Tháng" Width="150" />
                    <TableColumn TItem="KeywordMonthlyMetricDto" TType="int" @bind-Field="@context.SearchVol" Text="Search Volume" Width="200">
                        <Template Context="value">
                            <span>@value.Value.ToString("N0")</span>
                        </Template>
                    </TableColumn>
                    <TableColumn TItem="KeywordMonthlyMetricDto" TType="string" @bind-Field="@context.YearMonth" Text="Hành động" Width="100">
                        <Template Context="value">
                            <Button Color="Color.Danger" 
                                Icon="fa-solid fa-trash" 
                                Size="Size.Small"
                                OnClick="() => OnDeleteMetric(value.Row)" />
                        </Template>
                    </TableColumn>
                </TableColumns>
            </Table>
        }
        else
        {
            <div class="alert alert-info">
                <i class="fa-solid fa-info-circle me-2"></i>Chưa có dữ liệu search volume
            </div>
        }
    }
</div>

<style>
    .monthly-metrics-manager {
        margin-top: 2rem;
        padding: 1.5rem;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        background-color: #f8f9fa;
    }
</style>

