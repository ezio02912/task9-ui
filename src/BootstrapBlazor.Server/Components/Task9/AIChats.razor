@page "/ai-seo-chat"
@layout PageLayout
@inherits WebSiteModuleComponentBase
@inject IOptionsMonitor<WebsiteOptions> WebsiteOption
@attribute [JSModuleAutoLoader("Task9/AIChats.razor.js")]


<DemoBlock Title="Chat với AI SEO"  Name="Normal" ShowCode="false">
    <div class="chat-body">
        @if (Messages.Count == 0)
        {
            <div class="chat-welcome">
                <div class="chat-welcome-icon">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="chat-welcome-body">
                    <div class="chat-welcome-title">Bắt đầu chat</div>
                    <div class="chat-welcome-content">Hãy bắt đầu chat với AI SEO bằng cách gửi câu hỏi bên dưới. Sau đó điều chỉnh cấu hình AI SEO để cải thiện các câu trả lời của AI SEO.</div>
                </div>
            </div>
        }
        @foreach (var message in Messages)
        {
            <div class="@GetStackClass(message)" @key="message.id">
                <div class="msg-role">
                    @if (message.answer == "question")
                    {
                        <img src="@WebsiteOption.CurrentValue.GetAssetUrl("images/Argo-C.png")">
                    }
                    else
                    {
                        <i class="fa-solid fa-robot"></i>
                    }
                </div>
                <div class="msg-body">
                    <div class="msg-time">@message.createdAt.ToString("HH:mm:ss")</div>
                    @if (message.answer == "question")
                    {
                        <MarkdownContent Content="@message.question"></MarkdownContent>
                    }
                    else
                    {
                        @if (IsProgressMessage(message.answer))
                        {
                            <div class="jumping-line">
                                <MarkdownContent Content="@message.answer"></MarkdownContent>
                            </div>
                        }
                        else
                        {
                            <MarkdownContent Content="@message.answer"></MarkdownContent>
                            <div class="msg-desc">Nội dung được tạo bởi AI đánh giá trên database được team QC nhập vào hàng tháng. Nếu có thắc mắc hãy liên hệ với team QC.</div>
                        }
                    }
                </div>
            </div>
        }
    </div>
    <div class="chat-footer">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <label class="chat-info">Tổng số lượt chat: @Messages.Count</label>
            <div class="d-flex align-items-center">
                <span class="text-muted small">Đang sử dụng AI Claude 4</span>
            </div>
        </div>
        <div class="d-flex">
            <Textarea Id="@Id" class="chat-footer-tx" rows="3" @bind-Value="@Context" PlaceHolder="Nhập câu hỏi vào đây. (Shift + Enter để xuống dòng)"></Textarea>
            <div class="chat-buttons">
                <Button Icon="fa-regular fa-paper-plane" Color="Color.Primary" OnClick="GetCompletionsAsync" IsDisabled="_isDisabled" IsAsync="true" class="btn-send"></Button>
                <Button Icon="fa-solid fa-xmark" Color="Color.Danger" OnClick="CreateNewTopic" IsDisabled="_isDisabled" class="btn-clear"></Button>
            </div>
        </div>
    </div>
</DemoBlock>
